# core plugin configuration
# The main Han MCP server is defined in plugin.json (must be visible to Claude Code)
# context7 and deepwiki are exposed through Han's tool proxying

# MCP servers - used by MCP orchestrator AND available to memory system
mcp_servers:
  context7:
    name: context7
    description: Fetch up-to-date documentation and code examples for any library
    command: npx
    args: ["-y", "@upstash/context7-mcp"]
    expose: true
  deepwiki:
    name: deepwiki
    description: Access DeepWiki for GitHub repository documentation
    type: http
    url: https://mcp.deepwiki.com/mcp
    expose: true
  memory-dal:
    name: memory-dal
    description: Han internal memory database with FTS and vector search
    command: han
    args: ["mcp", "memory"]

# Core hooks - all hooks go through orchestrator
hooks:
  # SessionStart hooks - run at session start
  context:
    event: SessionStart
    command: han hook context
    description: Consolidated session context (session ID, performance metrics, memory context)

  no-time-estimates-ref:
    event: SessionStart
    command: han hook reference hooks/no-time-estimates.md --must-read-first "no time estimates policy"
    description: Reference no time estimates policy

  metrics-tracking-ref:
    event: SessionStart
    command: han hook reference hooks/metrics-tracking.md --must-read-first "metrics tracking guidelines"
    description: Reference metrics tracking guidelines

  professional-honesty-ref:
    event: SessionStart
    command: han hook reference hooks/professional-honesty.md --must-read-first "epistemic rigor and professional honesty"
    description: Reference professional honesty guidelines

  ensure-subagent-ref:
    event: SessionStart
    command: han hook reference hooks/ensure-subagent.md --must-read-first "subagent delegation rules"
    description: Reference subagent delegation rules

  bash-output-capture-ref:
    event: SessionStart
    command: han hook reference hooks/bash-output-capture.md --must-read-first "bash output capture best practices"
    description: Reference bash output capture practices

  ensure-skill-use-ref:
    event: SessionStart
    command: han hook reference hooks/ensure-skill-use.md --must-read-first "skill selection and transparency"
    description: Reference skill selection guidelines

  date-handling-ref:
    event: SessionStart
    command: han hook reference hooks/date-handling.md --must-read-first "date handling best practices"
    description: Reference date handling guidelines

  # UserPromptSubmit hooks - run on each user message
  current-datetime:
    event: UserPromptSubmit
    command: bash "${CLAUDE_PLUGIN_ROOT}/hooks/current-datetime.sh"
    description: Inject current datetime

  no-excuses-ref:
    event: UserPromptSubmit
    command: han hook reference hooks/no-excuses.md --must-read-first "no excuses for pre-existing issues"
    description: Reference no-excuses policy

  memory-learning-ref:
    event: UserPromptSubmit
    command: han hook reference hooks/memory-learning.md --must-read-first "autonomous self-learning rules"
    description: Reference memory learning guidelines

  memory-confidence-ref:
    event: UserPromptSubmit
    command: han hook reference hooks/memory-confidence.md --must-read-first "memory-augmented answers"
    description: Reference memory confidence guidelines

  # SubagentStart hooks - capture checkpoint when subagent starts
  subagent-checkpoint:
    event: SubagentStart
    command: han checkpoint capture
    description: Capture checkpoint when subagent starts for validation filtering

  # PreToolUse safety hooks - prevent dangerous operations
  safe-operations:
    event: PreToolUse
    tool_filter: [Write, Edit, Bash]
    command: python3 "${CLAUDE_PLUGIN_ROOT}/hooks/safe-operations.py"
    description: Block dangerous file operations and bash commands outside project directory

# Memory provider config - defines which tools the Memory Agent can use
memory:
  allowed_tools:
    - mcp__memory-dal__memory_search_fts
    - mcp__memory-dal__memory_search_vector
    - mcp__memory-dal__memory_search_hybrid
    - mcp__memory-dal__memory_list_layers
  system_prompt: |
    Search the internal Han memory database for relevant information.
    Use memory_search_hybrid for best results (combines keyword + semantic search).
    The database contains indexed transcripts, summaries, and team memory.
