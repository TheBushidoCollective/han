# core plugin configuration
# The main Han MCP server is defined in plugin.json (must be visible to Claude Code)
# context7 and deepwiki are exposed through Han's tool proxying

# MCP servers - exposed through main Han MCP server (han mcp)
mcp_servers:
  context7:
    name: context7
    description: Fetch up-to-date documentation and code examples for any library
    command: npx
    args: ["-y", "@upstash/context7-mcp"]
    expose: true
  deepwiki:
    name: deepwiki
    description: Access DeepWiki for GitHub repository documentation
    type: http
    url: https://mcp.deepwiki.com/mcp
    expose: true
  memory-dal:
    name: memory-dal
    description: Han internal memory database with FTS and vector search
    command: han
    args: ["mcp", "memory"]

# Core hooks - all hooks go through orchestrator
hooks:
  # Setup hook - runs on plugin installation
  setup:
    event: Setup
    command: bash "${CLAUDE_PLUGIN_ROOT}/hooks/setup.sh"
    description: Ensure han binary is installed and available

  # SessionStart hooks - run at session start
  coordinator:
    event: SessionStart
    command: han coordinator ensure --background
    description: Start coordinator daemon for indexing and hook caching (non-blocking)

  context:
    event: SessionStart
    command: han hook context
    description: Consolidated session context (session ID, performance metrics, memory context)

  session-references:
    event: SessionStart
    command: bash "${CLAUDE_PLUGIN_ROOT}/hooks/session-references.sh"
    description: Consolidated SessionStart reference hooks (no-time-estimates, professional-honesty, ensure-subagent, bash-output-capture, ensure-skill-use, date-handling)

  # UserPromptSubmit hooks - run on each user message
  current-datetime:
    event: UserPromptSubmit
    command: bash "${CLAUDE_PLUGIN_ROOT}/hooks/current-datetime.sh"
    description: Inject current datetime

  no-excuses-ref:
    event: UserPromptSubmit
    command: han hook reference hooks/no-excuses.md --must-read-first "no excuses for pre-existing issues"
    description: Reference no-excuses policy

  memory-learning-ref:
    event: UserPromptSubmit
    command: han hook reference hooks/memory-learning.md --must-read-first "autonomous self-learning rules"
    description: Reference memory learning guidelines

  memory-confidence-ref:
    event: UserPromptSubmit
    command: han hook reference hooks/memory-confidence.md --must-read-first "memory-augmented answers"
    description: Reference memory confidence guidelines

  # PreToolUse safety hooks - prevent dangerous operations
  safe-operations:
    event: PreToolUse
    tool_filter: [Write, Edit, Bash]
    command: python3 "${CLAUDE_PLUGIN_ROOT}/hooks/safe-operations.py"
    description: Block dangerous file operations and bash commands outside project directory

  # PreToolUse validation hook - run validation before git commits
  pre-commit-validation:
    event: PreToolUse
    tool_filter: [Bash]
    command: bash "${CLAUDE_PLUGIN_ROOT}/hooks/pre-commit-validation.sh"
    description: Run validation hooks before git commit to block bad commits

# Memory provider config - defines which tools the Memory Agent can use
memory:
  allowed_tools:
    - mcp__memory-dal__memory_search_fts
    - mcp__memory-dal__memory_search_vector
    - mcp__memory-dal__memory_search_hybrid
    - mcp__memory-dal__memory_list_layers
  system_prompt: |
    Search the internal Han memory database for relevant information.
    Use memory_search_hybrid for best results (combines keyword + semantic search).
    The database contains indexed transcripts, summaries, and team memory.
