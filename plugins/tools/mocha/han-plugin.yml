hooks:
  # Full test suite at Stop (checkpoint)
  test:
    event: Stop
    command: "npm test"
    dirs_with:
      - "package.json"
    dir_test: "grep -qE '\"mocha\":' package.json"
    if_changed:
      - "**/*.{js,jsx,ts,tsx,mjs,cjs}"
      - "test/**/*"
      - ".mocharc.*"

  # Single test file async on PostToolUse
  test-async:
    event: PostToolUse:Edit|Write
    command: "npx mocha ${HAN_FILES}"
    dirs_with:
      - "package.json"
    dir_test: "grep -qE '\"mocha\":' package.json"
    file_filter:
      - "**/*.test.{js,ts}"
      - "**/*.spec.{js,ts}"
      - "**/test/**/*.{js,ts}"
    file_test: grep -qE "(describe|it)\s*\(" "${HAN_FILE}"
