hooks:
  format:
    event: [Stop, PostToolUse:Edit|Write]
    command: "mix format --check-formatted ${HAN_FILES}"
    dirs_with:
      - ".formatter.exs"
    if_changed:
      - "**/*.ex"
      - "**/*.exs"
      - "**/*.eex"
      - "**/*.leex"
      - "**/*.heex"
      - ".formatter.exs"

  build:
    event: [Stop, PostToolUse:Edit|Write]
    command: "mix compile --warnings-as-errors"
    dirs_with:
      - "mix.exs"
    if_changed:
      - "**/*.ex"
      - "**/*.exs"
      - "**/*.eex"
      - "**/*.leex"
      - "**/*.heex"
      - "mix.exs"
      - "mix.lock"

  test:
    event: Stop
    command: "mix test"
    dirs_with:
      - "mix.exs"
    if_changed:
      - "**/*.ex"
      - "**/*.exs"
      - "**/*.eex"
      - "**/*.leex"
      - "**/*.heex"
      - "mix.exs"
      - "mix.lock"

  test-changed:
    event: PostToolUse:Edit|Write
    command: "mix test ${HAN_FILES}"
    dirs_with:
      - "mix.exs"
    if_changed:
      - "**/*_test.exs"
      - "**/test/**/*.exs"
    file_test: grep -qE "(describe|test|doctest)" "${HAN_FILE}"

  typecheck:
    event: Stop
    command: "mix dialyzer"
    dirs_with:
      - "mix.exs"
    if_changed:
      - "**/*.ex"
      - "**/*.exs"
      - "**/*.eex"
      - "**/*.leex"
      - "**/*.heex"
      - "mix.exs"
      - "mix.lock"

  coverage:
    event: Stop
    command: "bash \"${CLAUDE_PLUGIN_ROOT}/scripts/coverage-ratchet.sh\""
    dirs_with:
      - "coveralls.json"
    if_changed:
      - "**/*.ex"
      - "**/*.exs"
      - "mix.exs"
      - "mix.lock"
      - "coveralls.json"
