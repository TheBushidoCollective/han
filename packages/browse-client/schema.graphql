"""
Defers resolution of a fragment, allowing the rest of the response to be returned first
"""
directive @defer(
  """Condition to check if the fragment should be deferred"""
  if: Boolean

  """Unique label to identify the deferred fragment"""
  label: String
) on FRAGMENT_SPREAD | INLINE_FRAGMENT

"""A cached hook run entry"""
type CacheEntry {
  """Number of files tracked"""
  fileCount: Int

  """Hook name"""
  hookName: String

  """Cache entry ID"""
  id: ID

  """When the cache was last updated"""
  lastModified: DateTime

  """Path to cache file"""
  path: String

  """Plugin name"""
  pluginName: String
}

"""Aggregate cache statistics"""
type CacheStats {
  """Newest cache entry timestamp"""
  newestEntry: DateTime

  """Oldest cache entry timestamp"""
  oldestEntry: DateTime

  """Total number of cache entries"""
  totalEntries: Int

  """Total number of tracked files"""
  totalFiles: Int
}

"""A captured checkpoint of file state"""
type Checkpoint {
  """Original checkpoint ID"""
  checkpointId: String

  """When the checkpoint was created"""
  createdAt: DateTime

  """Number of files in checkpoint"""
  fileCount: Int

  """Checkpoint ID"""
  id: ID

  """Path to checkpoint file"""
  path: String

  """Number of glob patterns used"""
  patternCount: Int

  """Glob patterns used to capture files"""
  patterns: [String!]

  """Checkpoint type"""
  type: CheckpointType
}

"""Aggregate checkpoint statistics"""
type CheckpointStats {
  """Number of agent checkpoints"""
  agentCheckpoints: Int

  """Number of session checkpoints"""
  sessionCheckpoints: Int

  """Total number of checkpoints"""
  totalCheckpoints: Int

  """Total files tracked across all checkpoints"""
  totalFiles: Int
}

"""Type of checkpoint"""
enum CheckpointType {
  AGENT
  SESSION
}

"""Citation from memory search"""
type Citation {
  """Author if known"""
  author: String

  """Relevant excerpt"""
  excerpt: String

  """Memory layer this came from"""
  layer: MemoryLayer

  """Human-readable project name (e.g., han, website)"""
  projectName: String

  """Full filesystem path to the project"""
  projectPath: String

  """Source identifier"""
  source: String

  """Timestamp if known"""
  timestamp: DateTime
}

"""Summary of Claude user settings"""
type ClaudeSettingsSummary {
  """Whether the settings file exists"""
  exists: Boolean

  """Whether permissions are configured"""
  hasPermissions: Boolean

  """Last modification time"""
  lastModified: String

  """Number of configured MCP servers"""
  mcpServerCount: Int

  """Path to settings file"""
  path: String

  """Number of enabled plugins"""
  pluginCount: Int
}

"""Confidence level in search results"""
enum Confidence {
  HIGH
  LOW
  MEDIUM
}

scalar DateTime

"""Type of action that occurred"""
enum EventAction {
  CREATED
  DELETED
  UPDATED
}

"""Summary of Han user configuration"""
type HanConfigSummary {
  """Whether the config file exists"""
  exists: Boolean

  """Whether hooks are enabled"""
  hooksEnabled: Boolean

  """Last modification time"""
  lastModified: String

  """Whether memory is enabled"""
  memoryEnabled: Boolean

  """Whether metrics tracking is enabled"""
  metricsEnabled: Boolean

  """Path to config file"""
  path: String

  """Number of plugins with custom configuration"""
  pluginConfigCount: Int
}

"""A single hook execution record"""
type HookExecution {
  """Duration in milliseconds"""
  durationMs: Int

  """Error message if hook failed"""
  error: String

  """Exit code (0 = success)"""
  exitCode: Int

  """Name of the hook"""
  hookName: String

  """Plugin source of the hook"""
  hookSource: String

  """Type of hook (SessionStart, Stop, etc.)"""
  hookType: String

  """Hook execution ID"""
  id: String

  """Hook output (truncated if long)"""
  output: String

  """Whether the hook passed"""
  passed: Boolean

  """Session ID this hook ran in"""
  sessionId: String

  """Task ID this hook ran for"""
  taskId: String

  """When the hook executed"""
  timestamp: String
}

"""Hook execution statistics"""
type HookStats {
  """Statistics broken down by hook type"""
  byHookType: [HookTypeStat!]

  """Number of failed hooks"""
  failedHooks: Int

  """Pass rate as a percentage"""
  passRate: Float

  """Number of passed hooks"""
  passedHooks: Int

  """Total duration of all hooks in ms"""
  totalDurationMs: Int

  """Total hook executions"""
  totalHooks: Int
}

"""Hook statistics by type"""
type HookTypeStat {
  """Hook type name"""
  hookType: String

  """Passed executions"""
  passed: Int

  """Total executions of this type"""
  total: Int
}

"""An MCP server configuration"""
type McpServer {
  """Number of command arguments"""
  argCount: Int

  """Command to run the server"""
  command: String

  """Whether environment variables are configured"""
  hasEnv: Boolean

  """Server ID"""
  id: ID

  """Server name"""
  name: String

  """Server type (stdio or http)"""
  type: String

  """URL for HTTP servers"""
  url: String
}

"""Event emitted when memory changes"""
type MemoryEvent {
  """What action occurred"""
  action: EventAction

  """Path to the affected file"""
  path: String

  """ISO timestamp when the event occurred"""
  timestamp: String

  """Type of memory that changed"""
  type: MemoryEventType
}

"""Type of memory that changed"""
enum MemoryEventType {
  OBSERVATION
  RELOAD
  RULE
  SESSION
  SUMMARY
}

"""Layer in the memory system"""
enum MemoryLayer {
  OBSERVATIONS
  RULES
  SUMMARIES
  TEAM
  TRANSCRIPTS
}

"""Memory query interface"""
type MemoryQuery {
  """All project and user rules"""
  rules: [Rule!]

  """Search memory with a question"""
  search(layers: [MemoryLayer!], query: String!): MemorySearchResult
}

"""Result from memory search"""
type MemorySearchResult {
  """Answer synthesized from memory"""
  answer: String

  """Caveats or notes about the results"""
  caveats: [String!]

  """Citations supporting the answer"""
  citations: [Citation!]

  """Confidence in the answer"""
  confidence: Confidence

  """Which memory layers were searched"""
  layersSearched: [MemoryLayer!]

  """Primary source of the answer"""
  source: MemorySource
}

"""Source of memory search result"""
enum MemorySource {
  COMBINED
  PERSONAL
  RULES
  TEAM
  TRANSCRIPTS
}

"""A message in a session"""
type Message {
  """Message text content"""
  content: String

  """Message ID"""
  id: ID

  """Whether this message only contains tool calls"""
  isToolOnly: Boolean

  """When the message was sent"""
  timestamp: DateTime

  """Type of message"""
  type: MessageType
}

"""A paginated list of messages"""
type MessageConnection {
  """List of message edges"""
  edges: [MessageEdge!]

  """Pagination information"""
  pageInfo: PageInfo

  """Total number of messages in the session"""
  totalCount: Int
}

"""An edge in a message connection"""
type MessageEdge {
  """Cursor for this edge"""
  cursor: String

  """The message at this edge"""
  node: Message
}

"""Type of message in a session"""
enum MessageType {
  ASSISTANT
  SUMMARY
  USER
}

"""Aggregate metrics for a time period"""
type MetricsData {
  """Average confidence score (0-1)"""
  averageConfidence: Float

  """Average duration in seconds"""
  averageDuration: Float

  """Calibration score (how well confidence matches outcomes)"""
  calibrationScore: Float

  """Number of completed tasks"""
  completedTasks: Int

  """Most recent tasks"""
  recentTasks(first: Int = 10): [Task!]

  """Significant frustrations per task"""
  significantFrustrationRate: Float

  """Count of moderate/high frustration events"""
  significantFrustrations: Int

  """Success rate (0-1)"""
  successRate: Float

  """Task breakdown by outcome"""
  tasksByOutcome: [TaskOutcomeCount!]

  """Task breakdown by type"""
  tasksByType: [TaskTypeCount!]

  """Total number of tasks"""
  totalTasks: Int
}

"""Time period for metrics queries"""
enum MetricsPeriod {
  DAY
  MONTH
  WEEK
}

type Mutation {
  """Remove a plugin from settings"""
  removePlugin(marketplace: String!, name: String!, scope: PluginScope!): PluginMutationResult

  """Enable or disable a plugin"""
  togglePlugin(enabled: Boolean!, marketplace: String!, name: String!, scope: PluginScope!): PluginMutationResult
}

interface Node {
  id: ID!
}

"""Payload for node updated events"""
type NodeUpdatedPayload {
  """Global ID of the updated node"""
  id: String

  """The updated node"""
  node: Node

  """GraphQL typename of the updated node"""
  typename: String
}

"""Pagination information for a connection"""
type PageInfo {
  """Cursor of the last item in the current page"""
  endCursor: String

  """Whether there are more items after the current page"""
  hasNextPage: Boolean

  """Whether there are more items before the current page"""
  hasPreviousPage: Boolean

  """Cursor of the first item in the current page"""
  startCursor: String
}

"""Claude permissions configuration"""
type Permissions {
  """Additional allowed directories"""
  additionalDirectories: [String!]

  """List of allowed tools"""
  allowedTools: [String!]

  """List of denied tools"""
  deniedTools: [String!]
}

"""An installed plugin"""
type Plugin {
  """Plugin category based on naming convention"""
  category: String

  """Whether the plugin is enabled"""
  enabled: Boolean

  """Plugin ID"""
  id: ID

  """Marketplace the plugin is from"""
  marketplace: String

  """Plugin name"""
  name: String

  """Installation scope"""
  scope: PluginScope
}

"""Plugin count by category"""
type PluginCategory {
  """Category name"""
  category: String

  """Number of plugins in this category"""
  count: Int
}

"""Result of a plugin mutation"""
type PluginMutationResult {
  """Status message"""
  message: String

  """Whether the operation succeeded"""
  success: Boolean
}

"""Scope where plugin is installed"""
enum PluginScope {
  LOCAL
  PROJECT
  USER
}

"""Aggregate plugin statistics"""
type PluginStats {
  """Number of enabled plugins"""
  enabledPlugins: Int

  """Plugins installed at local scope"""
  localPlugins: Int

  """Plugins installed at project scope"""
  projectPlugins: Int

  """Total number of installed plugins"""
  totalPlugins: Int

  """Plugins installed at user scope"""
  userPlugins: Int
}

"""A project with sessions"""
type Project {
  """Global ID (Project_{projectId})"""
  id: ID

  """Most recent session timestamp"""
  lastActivity: DateTime

  """Display name for the project"""
  name: String

  """Plugins installed at project or local scope for this project"""
  plugins: [Plugin!]

  """
  Encoded directory path from ~/.claude/projects (e.g., -Volumes-dev-src-...)
  """
  projectId: String

  """The repository containing this project"""
  repo: Project

  """Git remote-based identifier (e.g., github-com-org-repo)"""
  repoId: String

  """Sessions in this project"""
  sessions(
    """Cursor to fetch sessions after"""
    after: String

    """Cursor to fetch sessions before"""
    before: String

    """Number of sessions to fetch from the start"""
    first: Int

    """Number of sessions to fetch from the end"""
    last: Int
  ): SessionConnection

  """URL-safe slug for routing (same as projectId)"""
  slug: String

  """Total sessions across all worktrees"""
  totalSessions: Int

  """All worktrees for this project"""
  worktrees: [Worktree!]
}

"""Payload for project added events"""
type ProjectAddedPayload {
  """Parent repo ID (for git projects)"""
  parentId: String

  """ID of the new project"""
  projectId: String
}

type Query {
  """Get an agent task by session ID and agent ID"""
  agentTask(agentId: String!, sessionId: String!): Session

  """All cache entries for the current project"""
  cacheEntries: [CacheEntry!]

  """Aggregate cache statistics"""
  cacheStats: CacheStats

  """Aggregate checkpoint statistics"""
  checkpointStats: CheckpointStats

  """All checkpoints for the current project"""
  checkpoints: [Checkpoint!]

  """Memory query interface"""
  memory: MemoryQuery

  """Task metrics for a time period"""
  metrics(period: MetricsPeriod): MetricsData
  node(id: ID!): Node
  nodes(ids: [ID!]!): [Node]!

  """Plugin counts by category"""
  pluginCategories: [PluginCategory!]

  """Aggregate plugin statistics"""
  pluginStats: PluginStats

  """Installed plugins, optionally filtered by scope"""
  plugins(scope: PluginScope): [Plugin!]

  """Get a project by ID"""
  project(id: String!): Project

  """All projects with sessions"""
  projects(first: Int = 20): [Project!]

  """Get a repo by its repoId (git remote-based ID)"""
  repo(id: String!): Repo

  """All git repositories with sessions"""
  repos(first: Int = 20): [Repo!]

  """Get a session by ID"""
  session(id: String!): Session

  """Get sessions with cursor-based pagination"""
  sessions(
    """Cursor to fetch sessions after"""
    after: String

    """Cursor to fetch sessions before"""
    before: String

    """Number of sessions to fetch from the start"""
    first: Int

    """Number of sessions to fetch from the end"""
    last: Int

    """Filter by project ID (groups all worktrees)"""
    projectId: String

    """Filter by worktree name/path"""
    worktreeName: String
  ): SessionConnection

  """Settings summary with all configuration locations"""
  settings(projectId: String): SettingsSummary
}

"""A git repository containing projects and sessions"""
type Repo implements Node {
  id: ID!

  """Most recent session timestamp"""
  lastActivity: DateTime

  """Display name for the repository"""
  name: String

  """Path to the repository root"""
  path: String

  """Git remote-based repository identifier (e.g., github-com-org-repo)"""
  repoId: String

  """All sessions in this repository"""
  sessions(
    """Cursor to fetch sessions after"""
    after: String

    """Cursor to fetch sessions before"""
    before: String

    """Number of sessions to fetch from the start"""
    first: Int

    """Number of sessions to fetch from the end"""
    last: Int
  ): SessionConnection

  """Total sessions across all projects in this repo"""
  totalSessions: Int
}

"""Payload for repo added events"""
type RepoAddedPayload {
  """ID of the new repo"""
  repoId: String
}

"""Payload for repo memory added events"""
type RepoMemoryAddedPayload {
  """Memory domain (e.g., 'rules', 'observations')"""
  domain: String

  """Path to the memory file"""
  path: String

  """ID of the repo"""
  repoId: String
}

"""A rule file from .claude/rules/"""
type Rule {
  """Rule content"""
  content: String

  """Domain/name of the rule"""
  domain: String

  """Rule ID"""
  id: ID

  """Full path to the rule file"""
  path: String

  """Whether this is a project or user rule"""
  scope: RuleScope

  """File size in bytes"""
  size: Int
}

"""Scope of a rule file"""
enum RuleScope {
  PROJECT
  USER
}

"""A Claude Code session"""
type Session implements Node {
  """Active (in-progress) tasks in this session"""
  activeTasks: [Task!]

  """Non-completed todos (pending or in-progress)"""
  activeTodos: [Todo!]

  """IDs of agent tasks spawned during this session"""
  agentTaskIds: [String!]

  """Checkpoints associated with this session"""
  checkpoints: [Checkpoint!]

  """The most recently started active task, if any"""
  currentTask: Task

  """The currently in-progress todo, if any"""
  currentTodo: Todo

  """Session date"""
  date: String

  """Git branch active during session"""
  gitBranch: String

  """Hook executions that occurred during this session"""
  hookExecutions: [HookExecution!]

  """Hook execution statistics for this session"""
  hookStats: HookStats
  id: ID!

  """Number of messages in session"""
  messageCount: Int

  """Paginated messages in this session"""
  messages(
    """Cursor to fetch messages after"""
    after: String

    """Cursor to fetch messages before"""
    before: String

    """Number of messages from the start"""
    first: Int

    """Number of messages from the end"""
    last: Int
  ): MessageConnection

  """Session name for URL routing (default is UUID, can be renamed)"""
  name: String

  """The project this session belongs to"""
  project: Project

  """Canonical project ID for grouping"""
  projectId: String

  """Project name"""
  projectName: String

  """Full project path"""
  projectPath: String

  """Encoded project directory for URL routing (e.g., -Volumes-dev-src-...)"""
  projectSlug: String

  """Session ID"""
  sessionId: String

  """Session start time"""
  startedAt: DateTime

  """First user message as summary"""
  summary: String

  """All tasks tracked in this session via start_task MCP tool"""
  tasks: [Task!]

  """Counts of todos by status"""
  todoCounts: TodoCounts

  """All todos from the most recent TodoWrite in this session"""
  todos: [Todo!]

  """When the session was last updated (most recent message)"""
  updatedAt: DateTime

  """Claude Code version"""
  version: String

  """Worktree name if part of multi-worktree project"""
  worktreeName: String
}

"""Payload for session added events"""
type SessionAddedPayload {
  """Parent project ID (if filtered)"""
  parentId: String

  """ID of the new session"""
  sessionId: String
}

"""A paginated list of sessions"""
type SessionConnection {
  """List of session edges"""
  edges: [SessionEdge!]

  """Pagination information"""
  pageInfo: PageInfo

  """Total number of sessions matching the query"""
  totalCount: Int
}

"""An edge in a session connection"""
type SessionEdge {
  """Cursor for this edge"""
  cursor: String

  """The session at this edge"""
  node: Session
}

"""Payload for session message added events"""
type SessionMessageAddedPayload {
  """Index of the new message in the session"""
  messageIndex: Int

  """ID of the session the message was added to"""
  sessionId: String
}

"""A settings file with source information"""
type SettingsFile {
  """Whether the file exists"""
  exists: Boolean

  """Last modification time"""
  lastModified: String

  """Path to settings file"""
  path: String

  """Source location (user, project, local, root, directory)"""
  source: String

  """Human-readable source label"""
  sourceLabel: String

  """File type (claude or han)"""
  type: String
}

"""Settings summary with all configuration locations"""
type SettingsSummary {
  """Claude settings summary (legacy)"""
  claudeSettings: ClaudeSettingsSummary

  """All Claude settings files with source information"""
  claudeSettingsFiles: [SettingsFile!]

  """Han configuration summary (legacy)"""
  hanConfig: HanConfigSummary

  """All Han config files with source information"""
  hanConfigFiles: [SettingsFile!]

  """Configured MCP servers"""
  mcpServers: [McpServer!]

  """Permissions configuration"""
  permissions: Permissions
}

"""A subdirectory within a worktree"""
type Subdir {
  """Full path to subdirectory"""
  path: String

  """Relative path from worktree root"""
  relativePath: String

  """Number of sessions in this subdirectory"""
  sessionCount: Int
}

type Subscription {
  """Subscribe to memory change events"""
  memoryUpdated: MemoryEvent

  """Subscribe to updates for a specific node"""
  nodeUpdated(
    """Global ID of the node to watch"""
    id: ID!
  ): NodeUpdatedPayload

  """Subscribe to new projects"""
  projectAdded(
    """Optional repo ID to filter by"""
    parentId: ID
  ): ProjectAddedPayload

  """Subscribe to new repos being added"""
  repoAdded: RepoAddedPayload

  """Subscribe to memory being added to a repo"""
  repoMemoryAdded(
    """Repo ID to watch for memory updates"""
    repoId: ID!
  ): RepoMemoryAddedPayload

  """Subscribe to new sessions"""
  sessionAdded(
    """Optional project ID to filter by"""
    parentId: ID
  ): SessionAddedPayload

  """Subscribe to new messages in a session"""
  sessionMessageAdded(
    """Session ID to watch for new messages"""
    sessionId: ID!
  ): SessionMessageAddedPayload
}

"""A tracked task"""
type Task {
  """When the task completed"""
  completedAt: DateTime

  """Confidence score (0-1)"""
  confidence: Float

  """Task description"""
  description: String

  """Duration in seconds"""
  durationSeconds: Int

  """List of modified files"""
  filesModified: [String!]

  """Task ID"""
  id: ID

  """Additional notes"""
  notes: String

  """Outcome if completed"""
  outcome: TaskOutcome

  """When the task started"""
  startedAt: DateTime

  """Current status"""
  status: TaskStatus

  """Task ID"""
  taskId: String

  """Number of tests added"""
  testsAdded: Int

  """Type of task"""
  type: TaskType
}

"""Outcome of a completed task"""
enum TaskOutcome {
  FAILURE
  PARTIAL
  SUCCESS
}

"""Task count by outcome"""
type TaskOutcomeCount {
  count: Int
  outcome: TaskOutcome
}

"""Status of a task"""
enum TaskStatus {
  ACTIVE
  COMPLETED
  FAILED
}

"""Type of task"""
enum TaskType {
  FIX
  IMPLEMENTATION
  REFACTOR
  RESEARCH
}

"""Task count by type"""
type TaskTypeCount {
  count: Int
  type: TaskType
}

"""A todo item from a Claude Code session"""
type Todo {
  """Present continuous form shown during execution"""
  activeForm: String

  """The todo item content (imperative form)"""
  content: String

  """Todo ID (content hash)"""
  id: ID

  """Current status of the todo"""
  status: TodoStatus
}

"""Counts of todos by status"""
type TodoCounts {
  """Number of completed todos"""
  completed: Int

  """Number of in-progress todos"""
  inProgress: Int

  """Number of pending todos"""
  pending: Int

  """Total number of todos"""
  total: Int
}

"""Status of a todo item"""
enum TodoStatus {
  COMPLETED
  IN_PROGRESS
  PENDING
}

"""A git worktree within a project"""
type Worktree {
  """Whether this is a linked worktree (vs main repo)"""
  isWorktree: Boolean

  """Worktree name"""
  name: String

  """Full path to worktree"""
  path: String

  """Number of sessions at this worktree root"""
  sessionCount: Int

  """Subdirectories with sessions within this worktree"""
  subdirs: [Subdir!]
}
