/* tslint:disable */
/* eslint-disable */
/* prettier-ignore */

/* auto-generated by NAPI-RS */

const { existsSync, readFileSync } = require('fs')
const { join } = require('path')

const { platform, arch } = process

let nativeBinding = null
let localFileExisted = false
let loadError = null

function isMusl() {
  // For Node 10
  if (!process.report || typeof process.report.getReport !== 'function') {
    try {
      const lddPath = require('child_process').execSync('which ldd').toString().trim()
      return readFileSync(lddPath, 'utf8').includes('musl')
    } catch (e) {
      return true
    }
  } else {
    const { glibcVersionRuntime } = process.report.getReport().header
    return !glibcVersionRuntime
  }
}

switch (platform) {
  case 'android':
    switch (arch) {
      case 'arm64':
        localFileExisted = existsSync(join(__dirname, 'han-native.android-arm64.node'))
        try {
          if (localFileExisted) {
            nativeBinding = require('./han-native.android-arm64.node')
          } else {
            nativeBinding = require('@thebushidocollective/han-native-android-arm64')
          }
        } catch (e) {
          loadError = e
        }
        break
      case 'arm':
        localFileExisted = existsSync(join(__dirname, 'han-native.android-arm-eabi.node'))
        try {
          if (localFileExisted) {
            nativeBinding = require('./han-native.android-arm-eabi.node')
          } else {
            nativeBinding = require('@thebushidocollective/han-native-android-arm-eabi')
          }
        } catch (e) {
          loadError = e
        }
        break
      default:
        throw new Error(`Unsupported architecture on Android ${arch}`)
    }
    break
  case 'win32':
    switch (arch) {
      case 'x64':
        localFileExisted = existsSync(
          join(__dirname, 'han-native.win32-x64-msvc.node')
        )
        try {
          if (localFileExisted) {
            nativeBinding = require('./han-native.win32-x64-msvc.node')
          } else {
            nativeBinding = require('@thebushidocollective/han-native-win32-x64-msvc')
          }
        } catch (e) {
          loadError = e
        }
        break
      case 'ia32':
        localFileExisted = existsSync(
          join(__dirname, 'han-native.win32-ia32-msvc.node')
        )
        try {
          if (localFileExisted) {
            nativeBinding = require('./han-native.win32-ia32-msvc.node')
          } else {
            nativeBinding = require('@thebushidocollective/han-native-win32-ia32-msvc')
          }
        } catch (e) {
          loadError = e
        }
        break
      case 'arm64':
        localFileExisted = existsSync(
          join(__dirname, 'han-native.win32-arm64-msvc.node')
        )
        try {
          if (localFileExisted) {
            nativeBinding = require('./han-native.win32-arm64-msvc.node')
          } else {
            nativeBinding = require('@thebushidocollective/han-native-win32-arm64-msvc')
          }
        } catch (e) {
          loadError = e
        }
        break
      default:
        throw new Error(`Unsupported architecture on Windows: ${arch}`)
    }
    break
  case 'darwin':
    localFileExisted = existsSync(join(__dirname, 'han-native.darwin-universal.node'))
    try {
      if (localFileExisted) {
        nativeBinding = require('./han-native.darwin-universal.node')
      } else {
        nativeBinding = require('@thebushidocollective/han-native-darwin-universal')
      }
      break
    } catch {}
    switch (arch) {
      case 'x64':
        localFileExisted = existsSync(join(__dirname, 'han-native.darwin-x64.node'))
        try {
          if (localFileExisted) {
            nativeBinding = require('./han-native.darwin-x64.node')
          } else {
            nativeBinding = require('@thebushidocollective/han-native-darwin-x64')
          }
        } catch (e) {
          loadError = e
        }
        break
      case 'arm64':
        localFileExisted = existsSync(
          join(__dirname, 'han-native.darwin-arm64.node')
        )
        try {
          if (localFileExisted) {
            nativeBinding = require('./han-native.darwin-arm64.node')
          } else {
            nativeBinding = require('@thebushidocollective/han-native-darwin-arm64')
          }
        } catch (e) {
          loadError = e
        }
        break
      default:
        throw new Error(`Unsupported architecture on macOS: ${arch}`)
    }
    break
  case 'freebsd':
    if (arch !== 'x64') {
      throw new Error(`Unsupported architecture on FreeBSD: ${arch}`)
    }
    localFileExisted = existsSync(join(__dirname, 'han-native.freebsd-x64.node'))
    try {
      if (localFileExisted) {
        nativeBinding = require('./han-native.freebsd-x64.node')
      } else {
        nativeBinding = require('@thebushidocollective/han-native-freebsd-x64')
      }
    } catch (e) {
      loadError = e
    }
    break
  case 'linux':
    switch (arch) {
      case 'x64':
        if (isMusl()) {
          localFileExisted = existsSync(
            join(__dirname, 'han-native.linux-x64-musl.node')
          )
          try {
            if (localFileExisted) {
              nativeBinding = require('./han-native.linux-x64-musl.node')
            } else {
              nativeBinding = require('@thebushidocollective/han-native-linux-x64-musl')
            }
          } catch (e) {
            loadError = e
          }
        } else {
          localFileExisted = existsSync(
            join(__dirname, 'han-native.linux-x64-gnu.node')
          )
          try {
            if (localFileExisted) {
              nativeBinding = require('./han-native.linux-x64-gnu.node')
            } else {
              nativeBinding = require('@thebushidocollective/han-native-linux-x64-gnu')
            }
          } catch (e) {
            loadError = e
          }
        }
        break
      case 'arm64':
        if (isMusl()) {
          localFileExisted = existsSync(
            join(__dirname, 'han-native.linux-arm64-musl.node')
          )
          try {
            if (localFileExisted) {
              nativeBinding = require('./han-native.linux-arm64-musl.node')
            } else {
              nativeBinding = require('@thebushidocollective/han-native-linux-arm64-musl')
            }
          } catch (e) {
            loadError = e
          }
        } else {
          localFileExisted = existsSync(
            join(__dirname, 'han-native.linux-arm64-gnu.node')
          )
          try {
            if (localFileExisted) {
              nativeBinding = require('./han-native.linux-arm64-gnu.node')
            } else {
              nativeBinding = require('@thebushidocollective/han-native-linux-arm64-gnu')
            }
          } catch (e) {
            loadError = e
          }
        }
        break
      case 'arm':
        if (isMusl()) {
          localFileExisted = existsSync(
            join(__dirname, 'han-native.linux-arm-musleabihf.node')
          )
          try {
            if (localFileExisted) {
              nativeBinding = require('./han-native.linux-arm-musleabihf.node')
            } else {
              nativeBinding = require('@thebushidocollective/han-native-linux-arm-musleabihf')
            }
          } catch (e) {
            loadError = e
          }
        } else {
          localFileExisted = existsSync(
            join(__dirname, 'han-native.linux-arm-gnueabihf.node')
          )
          try {
            if (localFileExisted) {
              nativeBinding = require('./han-native.linux-arm-gnueabihf.node')
            } else {
              nativeBinding = require('@thebushidocollective/han-native-linux-arm-gnueabihf')
            }
          } catch (e) {
            loadError = e
          }
        }
        break
      case 'riscv64':
        if (isMusl()) {
          localFileExisted = existsSync(
            join(__dirname, 'han-native.linux-riscv64-musl.node')
          )
          try {
            if (localFileExisted) {
              nativeBinding = require('./han-native.linux-riscv64-musl.node')
            } else {
              nativeBinding = require('@thebushidocollective/han-native-linux-riscv64-musl')
            }
          } catch (e) {
            loadError = e
          }
        } else {
          localFileExisted = existsSync(
            join(__dirname, 'han-native.linux-riscv64-gnu.node')
          )
          try {
            if (localFileExisted) {
              nativeBinding = require('./han-native.linux-riscv64-gnu.node')
            } else {
              nativeBinding = require('@thebushidocollective/han-native-linux-riscv64-gnu')
            }
          } catch (e) {
            loadError = e
          }
        }
        break
      case 's390x':
        localFileExisted = existsSync(
          join(__dirname, 'han-native.linux-s390x-gnu.node')
        )
        try {
          if (localFileExisted) {
            nativeBinding = require('./han-native.linux-s390x-gnu.node')
          } else {
            nativeBinding = require('@thebushidocollective/han-native-linux-s390x-gnu')
          }
        } catch (e) {
          loadError = e
        }
        break
      default:
        throw new Error(`Unsupported architecture on Linux: ${arch}`)
    }
    break
  default:
    throw new Error(`Unsupported OS: ${platform}, architecture: ${arch}`)
}

if (!nativeBinding) {
  if (loadError) {
    throw loadError
  }
  throw new Error(`Failed to load native binding`)
}

const { getOrCreateHookAttempt, incrementHookFailures, resetHookFailures, increaseHookMaxAttempts, createOrchestration, getOrchestration, updateOrchestration, cancelOrchestration, queuePendingHook, getPendingHooks, updateHookStatus, getOrchestrationHooks, getSessionPendingHooks, failHookExecution, completeHookExecution, queueHook, getQueuedHooks, deleteQueuedHooks, listPendingAsyncHooks, cancelPendingAsyncHooks, completeAsyncHook, cancelAsyncHook, clearAsyncHookQueueForSession, cleanupLegacyDatabase, hasLegacyDatabase, getGitBranch, getGitRoot, getGitCommonDir, getGitRemoteUrl, getGitInfo, gitLsFiles, gitWorktreeList, gitLog, gitShowFile, gitCreateBranch, gitWorktreeAdd, gitWorktreeRemove, gitDiffStat, jsonlCountLines, jsonlStats, jsonlReadPage, jsonlReadReverse, jsonlBuildIndex, jsonlSaveIndex, jsonlLoadIndex, jsonlReadIndexed, jsonlStream, jsonlFilter, jsonlFilterTimeRange, extractFileOperations, extractFileOperationsBatch, listSessionFiles, listJsonlFiles, pollIndexResults, FileEventType, startFileWatcher, addWatchPath, removeWatchPath, getWatchedPaths, stopFileWatcher, setIndexCallback, clearIndexCallback, isWatcherRunning, getDefaultWatchPath, computeFileHash, computeFileHashesParallel, findFilesWithGlob, findDirectoriesWithMarkers, buildManifest, hasChanges, checkAndBuildManifest, dbInit, ftsIndex, ftsSearch, ftsDelete, vectorIndex, vectorSearch, embeddingIsAvailable, embeddingEnsureAvailable, generateEmbeddings, generateEmbedding, getEmbeddingDimension, upsertRepo, getRepoByRemote, listRepos, upsertProject, getProjectBySlug, getProjectByPath, listProjects, upsertSession, endSession, getSession, listSessions, resetAllSessionsForReindex, registerConfigDir, getConfigDirByPath, listConfigDirs, updateConfigDirLastIndexed, unregisterConfigDir, getDefaultConfigDir, insertMessagesBatch, getMessage, listSessionMessages, getMessageCount, getMessageCountsBatch, getLastIndexedLine, getSessionTimestampsBatch, searchMessages, createTask, completeTask, failTask, getTask, queryTaskMetrics, recordHookExecution, queryHookStats, recordFrustration, queryFrustrationMetrics, recordFileChange, getSessionFileChanges, hasSessionChanges, recordFileValidation, getFileValidation, getSessionValidations, needsValidation, getAllSessionValidations, getFilesForValidation, deleteStaleValidations, upsertSessionSummary, getSessionSummary, upsertSessionCompact, getSessionCompact, upsertSessionTodos, getSessionTodos, upsertGeneratedSummary, getGeneratedSummary, searchGeneratedSummaries, listSessionsWithoutSummaries, getSessionNativeTasks, getNativeTask, tryAcquireCoordinatorLock, releaseCoordinatorLock, updateCoordinatorHeartbeat, getCoordinatorStatus, isCoordinator, getHeartbeatInterval, getStaleLockTimeout, cleanupStaleCoordinatorLock, indexSessionFile, indexProjectDirectory, handleFileEvent, fullScanAndIndex, enqueueAsyncHook, isAsyncHookQueueEmpty, drainAsyncHookQueue, truncateDerivedTables } = nativeBinding

module.exports.getOrCreateHookAttempt = getOrCreateHookAttempt
module.exports.incrementHookFailures = incrementHookFailures
module.exports.resetHookFailures = resetHookFailures
module.exports.increaseHookMaxAttempts = increaseHookMaxAttempts
module.exports.createOrchestration = createOrchestration
module.exports.getOrchestration = getOrchestration
module.exports.updateOrchestration = updateOrchestration
module.exports.cancelOrchestration = cancelOrchestration
module.exports.queuePendingHook = queuePendingHook
module.exports.getPendingHooks = getPendingHooks
module.exports.updateHookStatus = updateHookStatus
module.exports.getOrchestrationHooks = getOrchestrationHooks
module.exports.getSessionPendingHooks = getSessionPendingHooks
module.exports.failHookExecution = failHookExecution
module.exports.completeHookExecution = completeHookExecution
module.exports.queueHook = queueHook
module.exports.getQueuedHooks = getQueuedHooks
module.exports.deleteQueuedHooks = deleteQueuedHooks
module.exports.listPendingAsyncHooks = listPendingAsyncHooks
module.exports.cancelPendingAsyncHooks = cancelPendingAsyncHooks
module.exports.completeAsyncHook = completeAsyncHook
module.exports.cancelAsyncHook = cancelAsyncHook
module.exports.clearAsyncHookQueueForSession = clearAsyncHookQueueForSession
module.exports.cleanupLegacyDatabase = cleanupLegacyDatabase
module.exports.hasLegacyDatabase = hasLegacyDatabase
module.exports.getGitBranch = getGitBranch
module.exports.getGitRoot = getGitRoot
module.exports.getGitCommonDir = getGitCommonDir
module.exports.getGitRemoteUrl = getGitRemoteUrl
module.exports.getGitInfo = getGitInfo
module.exports.gitLsFiles = gitLsFiles
module.exports.gitWorktreeList = gitWorktreeList
module.exports.gitLog = gitLog
module.exports.gitShowFile = gitShowFile
module.exports.gitCreateBranch = gitCreateBranch
module.exports.gitWorktreeAdd = gitWorktreeAdd
module.exports.gitWorktreeRemove = gitWorktreeRemove
module.exports.gitDiffStat = gitDiffStat
module.exports.jsonlCountLines = jsonlCountLines
module.exports.jsonlStats = jsonlStats
module.exports.jsonlReadPage = jsonlReadPage
module.exports.jsonlReadReverse = jsonlReadReverse
module.exports.jsonlBuildIndex = jsonlBuildIndex
module.exports.jsonlSaveIndex = jsonlSaveIndex
module.exports.jsonlLoadIndex = jsonlLoadIndex
module.exports.jsonlReadIndexed = jsonlReadIndexed
module.exports.jsonlStream = jsonlStream
module.exports.jsonlFilter = jsonlFilter
module.exports.jsonlFilterTimeRange = jsonlFilterTimeRange
module.exports.extractFileOperations = extractFileOperations
module.exports.extractFileOperationsBatch = extractFileOperationsBatch
module.exports.listSessionFiles = listSessionFiles
module.exports.listJsonlFiles = listJsonlFiles
module.exports.pollIndexResults = pollIndexResults
module.exports.FileEventType = FileEventType
module.exports.startFileWatcher = startFileWatcher
module.exports.addWatchPath = addWatchPath
module.exports.removeWatchPath = removeWatchPath
module.exports.getWatchedPaths = getWatchedPaths
module.exports.stopFileWatcher = stopFileWatcher
module.exports.setIndexCallback = setIndexCallback
module.exports.clearIndexCallback = clearIndexCallback
module.exports.isWatcherRunning = isWatcherRunning
module.exports.getDefaultWatchPath = getDefaultWatchPath
module.exports.computeFileHash = computeFileHash
module.exports.computeFileHashesParallel = computeFileHashesParallel
module.exports.findFilesWithGlob = findFilesWithGlob
module.exports.findDirectoriesWithMarkers = findDirectoriesWithMarkers
module.exports.buildManifest = buildManifest
module.exports.hasChanges = hasChanges
module.exports.checkAndBuildManifest = checkAndBuildManifest
module.exports.dbInit = dbInit
module.exports.ftsIndex = ftsIndex
module.exports.ftsSearch = ftsSearch
module.exports.ftsDelete = ftsDelete
module.exports.vectorIndex = vectorIndex
module.exports.vectorSearch = vectorSearch
module.exports.embeddingIsAvailable = embeddingIsAvailable
module.exports.embeddingEnsureAvailable = embeddingEnsureAvailable
module.exports.generateEmbeddings = generateEmbeddings
module.exports.generateEmbedding = generateEmbedding
module.exports.getEmbeddingDimension = getEmbeddingDimension
module.exports.upsertRepo = upsertRepo
module.exports.getRepoByRemote = getRepoByRemote
module.exports.listRepos = listRepos
module.exports.upsertProject = upsertProject
module.exports.getProjectBySlug = getProjectBySlug
module.exports.getProjectByPath = getProjectByPath
module.exports.listProjects = listProjects
module.exports.upsertSession = upsertSession
module.exports.endSession = endSession
module.exports.getSession = getSession
module.exports.listSessions = listSessions
module.exports.resetAllSessionsForReindex = resetAllSessionsForReindex
module.exports.registerConfigDir = registerConfigDir
module.exports.getConfigDirByPath = getConfigDirByPath
module.exports.listConfigDirs = listConfigDirs
module.exports.updateConfigDirLastIndexed = updateConfigDirLastIndexed
module.exports.unregisterConfigDir = unregisterConfigDir
module.exports.getDefaultConfigDir = getDefaultConfigDir
module.exports.insertMessagesBatch = insertMessagesBatch
module.exports.getMessage = getMessage
module.exports.listSessionMessages = listSessionMessages
module.exports.getMessageCount = getMessageCount
module.exports.getMessageCountsBatch = getMessageCountsBatch
module.exports.getLastIndexedLine = getLastIndexedLine
module.exports.getSessionTimestampsBatch = getSessionTimestampsBatch
module.exports.searchMessages = searchMessages
module.exports.createTask = createTask
module.exports.completeTask = completeTask
module.exports.failTask = failTask
module.exports.getTask = getTask
module.exports.queryTaskMetrics = queryTaskMetrics
module.exports.recordHookExecution = recordHookExecution
module.exports.queryHookStats = queryHookStats
module.exports.recordFrustration = recordFrustration
module.exports.queryFrustrationMetrics = queryFrustrationMetrics
module.exports.recordFileChange = recordFileChange
module.exports.getSessionFileChanges = getSessionFileChanges
module.exports.hasSessionChanges = hasSessionChanges
module.exports.recordFileValidation = recordFileValidation
module.exports.getFileValidation = getFileValidation
module.exports.getSessionValidations = getSessionValidations
module.exports.needsValidation = needsValidation
module.exports.getAllSessionValidations = getAllSessionValidations
module.exports.getFilesForValidation = getFilesForValidation
module.exports.deleteStaleValidations = deleteStaleValidations
module.exports.upsertSessionSummary = upsertSessionSummary
module.exports.getSessionSummary = getSessionSummary
module.exports.upsertSessionCompact = upsertSessionCompact
module.exports.getSessionCompact = getSessionCompact
module.exports.upsertSessionTodos = upsertSessionTodos
module.exports.getSessionTodos = getSessionTodos
module.exports.upsertGeneratedSummary = upsertGeneratedSummary
module.exports.getGeneratedSummary = getGeneratedSummary
module.exports.searchGeneratedSummaries = searchGeneratedSummaries
module.exports.listSessionsWithoutSummaries = listSessionsWithoutSummaries
module.exports.getSessionNativeTasks = getSessionNativeTasks
module.exports.getNativeTask = getNativeTask
module.exports.tryAcquireCoordinatorLock = tryAcquireCoordinatorLock
module.exports.releaseCoordinatorLock = releaseCoordinatorLock
module.exports.updateCoordinatorHeartbeat = updateCoordinatorHeartbeat
module.exports.getCoordinatorStatus = getCoordinatorStatus
module.exports.isCoordinator = isCoordinator
module.exports.getHeartbeatInterval = getHeartbeatInterval
module.exports.getStaleLockTimeout = getStaleLockTimeout
module.exports.cleanupStaleCoordinatorLock = cleanupStaleCoordinatorLock
module.exports.indexSessionFile = indexSessionFile
module.exports.indexProjectDirectory = indexProjectDirectory
module.exports.handleFileEvent = handleFileEvent
module.exports.fullScanAndIndex = fullScanAndIndex
module.exports.enqueueAsyncHook = enqueueAsyncHook
module.exports.isAsyncHookQueueEmpty = isAsyncHookQueueEmpty
module.exports.drainAsyncHookQueue = drainAsyncHookQueue
module.exports.truncateDerivedTables = truncateDerivedTables
